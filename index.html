<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>神秘塔羅占卜 (Mystic Tarot)</title>
    
    <!-- 引入 Tailwind CSS (用於樣式) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 引入 React 和 ReactDOM (用於邏輯) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 引入 Babel (用於在瀏覽器中編譯 JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 自定義樣式 (用於 3D 翻轉效果與洗牌動畫) -->
    <style>
        .perspective-1000 {
            perspective: 1000px;
        }
        .preserve-3d {
            transform-style: preserve-3d;
        }
        .backface-hidden {
            backface-visibility: hidden;
        }
        .rotate-y-180 {
            transform: rotateY(180deg);
        }
        @keyframes pulse-slow {
            0%, 100% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.1); }
        }
        .animate-pulse-slow {
            animation: pulse-slow 3s infinite;
        }
        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-fade-in {
            animation: fade-in 0.8s ease-out forwards;
        }
        @keyframes slide-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide-up {
            animation: slide-up 0.6s ease-out forwards;
        }
        @keyframes fade-in-down {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-down {
            animation: fade-in-down 0.8s ease-out forwards;
        }

        /* --- 洗牌動畫特效 --- */
        @keyframes shuffleLeft {
            0%, 100% { transform: translateX(0) rotate(0); }
            50% { transform: translateX(-60px) rotate(-12deg); }
        }
        @keyframes shuffleRight {
            0%, 100% { transform: translateX(0) rotate(0); }
            50% { transform: translateX(60px) rotate(12deg); }
        }
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow {
            animation: spin-slow 8s linear infinite;
        }

        /* 滾動條樣式 */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        body {
            background-color: #020617; /* bg-slate-950 */
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- 圖標組件 (SVG) ---
        const Sparkles = ({ className, size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 9h4"/></svg>
        );
        const RefreshCw = ({ className, size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
        );
        const RotateCcw = ({ className, size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
        );
        const Info = ({ className, size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
        );
        const HelpCircle = ({ className, size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>
        );
        const X = ({ className, size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        );

        // --- 塔羅牌數據 (大阿爾克那 22 張) ---
        const TAROT_DATA = [
            { id: 0, name: "愚者 (The Fool)", keyword: "新的開始", image: "https://upload.wikimedia.org/wikipedia/commons/9/90/RWS_Tarot_00_Fool.jpg", baseMeaning: "天真、自由、冒險、無畏的開始。暗示著你需要放下恐懼，勇敢踏出第一步。" },
            { id: 1, name: "魔術師 (The Magician)", keyword: "創造力", image: "https://upload.wikimedia.org/wikipedia/commons/d/de/RWS_Tarot_01_Magician.jpg", baseMeaning: "掌握資源、展現實力、自信與行動力。現在是你將想法轉化為現實的最佳時機。" },
            { id: 2, name: "女祭司 (The High Priestess)", keyword: "直覺", image: "https://upload.wikimedia.org/wikipedia/commons/8/88/RWS_Tarot_02_High_Priestess.jpg", baseMeaning: "內在智慧、神秘、潛意識。請相信你的直覺，答案就在你的內心深處。" },
            { id: 3, name: "女皇 (The Empress)", keyword: "豐盛", image: "https://upload.wikimedia.org/wikipedia/commons/d/d2/RWS_Tarot_03_Empress.jpg", baseMeaning: "母性、自然、感官享受、孕育新事物。象徵著富足與收穫的時期。" },
            { id: 4, name: "皇帝 (The Emperor)", keyword: "權威", image: "https://upload.wikimedia.org/wikipedia/commons/c/c3/RWS_Tarot_04_Emperor.jpg", baseMeaning: "結構、穩定、領導力、父性力量。需要建立秩序與紀律來達成目標。" },
            { id: 5, name: "教皇 (The Hierophant)", keyword: "傳統", image: "https://upload.wikimedia.org/wikipedia/commons/8/8d/RWS_Tarot_05_Hierophant.jpg", baseMeaning: "信仰、學習、傳統價值觀、精神指引。尋求長輩或導師的建議會有所幫助。" },
            { id: 6, name: "戀人 (The Lovers)", keyword: "選擇", image: "https://upload.wikimedia.org/wikipedia/commons/d/db/RWS_Tarot_06_Lovers.jpg", baseMeaning: "愛、和諧、關係、重要的抉擇。不僅指愛情，也代表價值觀的選擇與結合。" },
            { id: 7, name: "戰車 (The Chariot)", keyword: "勝利", image: "https://upload.wikimedia.org/wikipedia/commons/9/9b/RWS_Tarot_07_Chariot.jpg", baseMeaning: "意志力、決心、克服障礙。只要保持專注與控制，你將能夠戰勝困難。" },
            { id: 8, name: "力量 (Strength)", keyword: "勇氣", image: "https://upload.wikimedia.org/wikipedia/commons/f/f5/RWS_Tarot_08_Strength.jpg", baseMeaning: "內在力量、耐心、同理心。以柔克剛，真正的力量來自於內心的堅定。" },
            { id: 9, name: "隱士 (The Hermit)", keyword: "內省", image: "https://upload.wikimedia.org/wikipedia/commons/4/4d/RWS_Tarot_09_Hermit.jpg", baseMeaning: "尋求真理、獨處、深思熟慮。現在是暫時退隱，反思自我的時刻。" },
            { id: 10, name: "命運之輪 (Wheel of Fortune)", keyword: "轉變", image: "https://upload.wikimedia.org/wikipedia/commons/3/3c/RWS_Tarot_10_Wheel_of_Fortune.jpg", baseMeaning: "機遇、週期、命運的轉折點。順應變化，好運即將到來，但也提醒世事無常。" },
            { id: 11, name: "正義 (Justice)", keyword: "平衡", image: "https://upload.wikimedia.org/wikipedia/commons/e/e0/RWS_Tarot_11_Justice.jpg", baseMeaning: "公平、真理、因果報應。理性地看待問題，做出公正的決定。" },
            { id: 12, name: "倒吊人 (The Hanged Man)", keyword: "犧牲", image: "https://upload.wikimedia.org/wikipedia/commons/2/2b/RWS_Tarot_12_Hanged_Man.jpg", baseMeaning: "換個角度看世界、等待、放下。暫時的停滯是為了獲得更高的智慧。" },
            { id: 13, name: "死神 (Death)", keyword: "結束與重生", image: "https://upload.wikimedia.org/wikipedia/commons/d/d7/RWS_Tarot_13_Death.jpg", baseMeaning: "徹底的改變、告別過去、新的階段。不要抗拒結束，這是重生的必經之路。" },
            { id: 14, name: "節制 (Temperance)", keyword: "調和", image: "https://upload.wikimedia.org/wikipedia/commons/f/f8/RWS_Tarot_14_Temperance.jpg", baseMeaning: "平衡、耐心、適度、療癒。尋找中庸之道，融合對立的力量。" },
            { id: 15, name: "惡魔 (The Devil)", keyword: "束縛", image: "https://upload.wikimedia.org/wikipedia/commons/5/55/RWS_Tarot_15_Devil.jpg", baseMeaning: "物質慾望、執著、誘惑。覺察自己的陰暗面，打破自我設限的枷鎖。" },
            { id: 16, name: "高塔 (The Tower)", keyword: "崩塌", image: "https://upload.wikimedia.org/wikipedia/commons/5/53/RWS_Tarot_16_Tower.jpg", baseMeaning: "突如其來的劇變、毀滅、覺醒。雖然痛苦，但這會打破虛假的幻象。" },
            { id: 17, name: "星星 (The Star)", keyword: "希望", image: "https://upload.wikimedia.org/wikipedia/commons/d/db/RWS_Tarot_17_Star.jpg", baseMeaning: "靈感、平靜、療癒、美好的前景。經歷風雨後，看見了指引方向的星光。" },
            { id: 18, name: "月亮 (The Moon)", keyword: "幻象", image: "https://upload.wikimedia.org/wikipedia/commons/7/7f/RWS_Tarot_18_Moon.jpg", baseMeaning: "不安、恐懼、潛意識、模糊不清。面對內心的陰影，小心不要被假象迷惑。" },
            { id: 19, name: "太陽 (The Sun)", keyword: "成功", image: "https://upload.wikimedia.org/wikipedia/commons/1/17/RWS_Tarot_19_Sun.jpg", baseMeaning: "喜悅、活力、清晰、積極的能量。一切都將明朗化，充滿溫暖與快樂。" },
            { id: 20, name: "審判 (Judgement)", keyword: "覺醒", image: "https://upload.wikimedia.org/wikipedia/commons/d/dd/RWS_Tarot_20_Judgement.jpg", baseMeaning: "召喚、重生、重要的決定。回顧過去，原諒自己，準備進入新的階段。" },
            { id: 21, name: "世界 (The World)", keyword: "圓滿", image: "https://upload.wikimedia.org/wikipedia/commons/f/ff/RWS_Tarot_21_World.jpg", baseMeaning: "完成、整合、達成目標、完美的結局。一個週期的結束，也是新旅程的起點。" },
        ];

        // --- 產生詳細解讀的函數 ---
        const generateInterpretation = (card, position) => {
            const base = card.baseMeaning;
            let specific = "";

            switch (card.id) {
                case 0: // 愚者
                if (position === "過去") specific = "過去你可能經歷了一段無憂無慮、充滿冒險的時光，或者做出了一個大膽的決定。";
                else if (position === "現在") specific = "現在是時候擁抱新的機會，不要過度擔憂後果，相信你的直覺，踏上新的旅程。";
                else specific = "未來充滿了無限的可能性，一個全新的開始在等著你，保持開放的心態去迎接它。";
                break;
                case 1: // 魔術師
                if (position === "過去") specific = "過去你曾成功地運用你的技能和資源來實現目標，展現了強大的創造力。";
                else if (position === "現在") specific = "現在你擁有實現目標所需的一切工具和能力，關鍵在於你的專注和行動力。";
                else specific = "未來你將有機會展現你的才華，透過你的意志力和行動，將夢想轉化為現實。";
                break;
                case 2: // 女祭司
                if (position === "過去") specific = "過去你可能更依賴直覺或內在的聲音來做決定，或者經歷了一段內省的時期。";
                else if (position === "現在") specific = "現在需要靜下心來，傾聽你內在的智慧和直覺，答案往往隱藏在表面之下。";
                else specific = "未來你將對事物有更深層的洞察力，某些隱藏的真相或知識將會顯現。";
                break;
                case 3: // 女皇
                if (position === "過去") specific = "過去是一段充滿愛、關懷和物質豐盛的時期，可能與家庭或創造性項目有關。";
                else if (position === "現在") specific = "現在是享受生活、培養創造力和關懷他人的好時機。你也可能正在孕育一個新的想法或計劃。";
                else specific = "未來將會是一個收穫和富足的時期，你的努力將會開花結果，帶來喜悅和滿足。";
                break;
                case 4: // 皇帝
                if (position === "過去") specific = "過去你可能受到一位權威人物的影響，或者在一個結構嚴謹的環境中成長。";
                else if (position === "現在") specific = "現在需要建立秩序、紀律和穩定的基礎。展現你的領導力，理性地規劃和執行。";
                else specific = "未來你將獲得更大的權力和影響力，透過建立穩固的結構和規則來實現你的目標。";
                break;
                case 5: // 教皇
                if (position === "過去") specific = "過去你可能遵循傳統的價值觀或信仰，或者受到一位導師或團體的指引。";
                else if (position === "現在") specific = "現在是尋求指導、學習和遵循既定規則的時候。加入一個團體或尋求專家的建議可能會有所幫助。";
                else specific = "未來你將更深入地探索精神層面，或者成為他人的導師，傳遞你的知識和信仰。";
                break;
                case 6: // 戀人
                if (position === "過去") specific = "過去你可能面臨一個重要的關係或價值觀的選擇，這個選擇對你產生了深遠的影響。";
                else if (position === "現在") specific = "現在你面臨著一個重要的抉擇，可能與夥伴關係、合作或個人價值觀有關。跟隨你的心。";
                else specific = "未來將會有一段和諧、充滿愛的關係出現，或者你將在不同的選擇中找到完美的平衡。";
                break;
                case 7: // 戰車
                if (position === "過去") specific = "過去你憑藉著堅強的意志力和決心，克服了重重困難，取得了勝利。";
                else if (position === "現在") specific = "現在需要保持專注和控制，勇往直前。你的決心和行動力將帶領你克服眼前的挑戰。";
                else specific = "未來你將在競爭中脫穎而出，實現你的目標。勝利屬於那些堅持到底的人。";
                break;
                case 8: // 力量
                if (position === "過去") specific = "過去你展現了極大的耐心和內在力量，以柔克剛地化解了困難或衝突。";
                else if (position === "現在") specific = "現在需要運用你的內在力量、同理心和耐心來面對挑戰。相信你自己的能力。";
                else specific = "未來你將更有自信和勇氣去面對任何考驗，你的內在力量將是你最強大的武器。";
                break;
                case 9: // 隱士
                if (position === "過去") specific = "過去你可能經歷了一段孤獨、內省和尋求自我真理的時期。";
                else if (position === "現在") specific = "現在是時候暫時從外界的喧囂中退隱，花時間獨處，反思你的方向和目標。";
                else specific = "未來你將獲得深刻的智慧和自我認識，找到屬於你自己的道路和答案。";
                break;
                case 10: // 命運之輪
                if (position === "過去") specific = "過去你可能經歷了命运的转折点或重大的变化，有好有坏，但这都是生命周期的一部分。";
                else if (position === "現在") specific = "現在正處於一個變動的時期，充滿了機遇。順應時勢，保持靈活，好運可能會突然降臨。";
                else specific = "未來將迎來一個新的循環或階段，命運的齒輪正在轉動，帶來意想不到的變化。";
                break;
                case 11: // 正義
                if (position === "過去") specific = "過去你可能面臨一個需要做出公正決定的情況，或者經歷了因果報應。";
                else if (position === "現在") specific = "現在需要理性、客觀地看待問題，做出公平和誠實的決定。你的行為將會產生相應的結果。";
                else specific = "未來一切都將得到公平的裁決，真相將會大白，正義終將得到伸張。";
                break;
                case 12: // 倒吊人
                if (position === "過去") specific = "過去你可能被迫做出犧牲，或者經歷了一段停滯不前的時期，但這讓你獲得了新的視角。";
                else if (position === "現在") specific = "現在可能感到卡住或停滯，但这是一個換個角度看世界的機會。試著放下控制，等待時機。";
                else specific = "未來你將會從一個全新的角度來看待事物，這種視角的轉變將帶來深刻的智慧和解脫。";
                break;
                case 13: // 死神
                if (position === "過去") specific = "過去你經歷了一個重大的結束或轉變，這可能是一段關係、一份工作或一種生活方式的結束。";
                else if (position === "現在") specific = "現在正面臨一個不可避免的改變。不要抗拒結束，因為這將為新的開始騰出空間。";
                else specific = "未來將迎來一個徹底的轉變和重生。舊的事物將會離去，為全新的階段讓路。";
                break;
                case 14: // 節制
                if (position === "過去") specific = "過去你成功地在對立的力量之間找到了平衡，展現了耐心和適度。";
                else if (position === "現在") specific = "現在需要尋求平衡和調和。避免極端，練習耐心，尋找不同觀點之間的共同點。";
                else specific = "未來你將達到一種內在的平靜和諧，能夠整合你生活中的不同面向，帶來療癒。";
                break;
            case 15: // 惡魔
                if (position === "過去") specific = "過去你可能被物質慾望、不良習慣或不健康的關係所束縛。";
                else if (position === "現在") specific = "現在需要覺察你自己的陰暗面和執著。你可能感到被某种情況或想法所困住，但鑰匙其實在你手中。";
                else specific = "未來你將有機會打破自我設限的枷鎖，從束縛中解脫出來，重獲自由。";
                break;
            case 16: // 高塔
                if (position === "過去") specific = "過去你可能經歷了一次突如其來的劇變或崩塌，打破了你原有的信念或結構。";
                else if (position === "現在") specific = "現在可能會發生意想不到的改變，雖然令人震驚，但這會打破虛假的幻象，帶來覺醒。";
                else specific = "未來可能會發生一次重大的變革，這將清除不再為你服務的事物，為建立更真實的基礎鋪路。";
                break;
            case 17: // 星星
                if (position === "過去") specific = "過去在困難時期，你保持了希望和信念，這幫助你度過了難關。";
                else if (position === "現在") specific = "現在是充滿希望和靈感的時期。相信你的夢想，保持樂觀，宇宙正在指引你。";
                else specific = "未來前景光明，你的願望將會實現。你將會感到平靜、療癒和目標清晰。";
                break;
            case 18: // 月亮
                if (position === "過去") specific = "過去你可能經歷了一段迷惘、不安或被欺騙的時期，對真相感到模糊不清。";
                else if (position === "現在") specific = "現在你的直覺和潛意識非常活躍，但也伴隨著恐懼和不安。小心不要被幻象所迷惑。";
                else specific = "未來你需要面對你內心的恐懼和陰影。通過探索你的潛意識，你將找到清晰和真相。";
                break;
            case 19: // 太陽
                if (position === "過去") specific = "過去是一段充滿快樂、成功和活力的時期，你感到自信和滿足。";
                else if (position === "現在") specific = "現在充滿了積極的能量、喜悅和清晰。一切都將明朗化，享受當下的成功和快樂。";
                else specific = "未來將是光明的，充滿成功、榮耀和幸福。你的努力將會得到回報。";
                break;
            case 20: // 審判
                if (position === "過去") specific = "過去你可能做出了一個重要的決定，或者經歷了一次覺醒，改變了你的人生方向。";
                else if (position === "現在") specific = "現在是反思過去、評估你的選擇並做出重要決定的時候。這是一個覺醒和重生的機會。";
                else specific = "未來你將會回應一個更高的召喚，進入一個新的生命階段。原諒過去，擁抱新的開始。";
                break;
            case 21: // 世界
                if (position === "過去") specific = "過去你成功地完成了一個重要的目標或階段，感到圓滿和成就感。";
                else if (position === "現在") specific = "現在一個週期即將結束，你即將達成你的目標。享受這份成就感，並準備迎接新的旅程。";
                else specific = "未來你將會實現你的夢想，達到一個完美的境界。這是一個整合、圓滿和慶祝的時刻。";
                break;
            default:
                specific = base;
            }

            return `【${position}】的指引：${specific} \n\n(核心牌義：${base})`;
        };

        // --- 規則說明彈出視窗 ---
        const RulesModal = ({ isOpen, onClose }) => {
            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm animate-fade-in">
                    <div className="bg-slate-900 border border-yellow-600/50 rounded-xl max-w-lg w-full p-6 shadow-2xl relative animate-slide-up">
                        <button 
                            onClick={onClose}
                            className="absolute top-4 right-4 text-slate-400 hover:text-white transition-colors"
                        >
                            <X size={24} />
                        </button>
                        
                        <h2 className="text-2xl font-serif text-yellow-400 mb-4 flex items-center">
                            <Info className="mr-2" /> 占卜規則與說明
                        </h2>
                        
                        <div className="space-y-4 text-slate-300 overflow-y-auto max-h-[60vh] pr-2 custom-scrollbar">
                            <section>
                                <h3 className="text-lg font-bold text-white mb-1">準備心境</h3>
                                <p className="text-sm">在開始之前，請找一個安靜的地方，深呼吸，讓心情平靜下來。在心中默念你想要詢問的問題，或者只想了解目前的運勢。</p>
                            </section>
                            
                            <section>
                                <h3 className="text-lg font-bold text-white mb-1">牌陣：聖三角</h3>
                                <p className="text-sm">本網站使用經典的「聖三角」牌陣，透過三張牌來解析時間流動中的因果關係：</p>
                                <div className="flex flex-col space-y-2 mt-2 text-sm text-indigo-200">
                                    <div className="flex items-start">
                                        <span className="text-yellow-500 mr-2 mt-0.5">•</span>
                                        <span><span className="text-yellow-500 font-bold">第一張（過去）：</span> 代表問題的成因、過去的經驗或基礎。</span>
                                    </div>
                                    <div className="flex items-start">
                                        <span className="text-yellow-500 mr-2 mt-0.5">•</span>
                                        <span><span className="text-yellow-500 font-bold">第二張（現在）：</span> 代表目前的狀況、面臨的挑戰或當下的能量。</span>
                                    </div>
                                    <div className="flex items-start">
                                        <span className="text-yellow-500 mr-2 mt-0.5">•</span>
                                        <span><span className="text-yellow-500 font-bold">第三張（未來）：</span> 代表未來的發展趨勢、可能的結果或建議。</span>
                                    </div>
                                </div>
                            </section>

                            <section>
                                <h3 className="text-lg font-bold text-white mb-1">操作步驟</h3>
                                <div className="flex flex-col space-y-2 mt-2 text-sm">
                                    <div className="flex items-start">
                                        <span className="text-yellow-500 font-bold mr-2 shrink-0">1.</span>
                                        <span>點擊<span className="text-purple-400 mx-1">開始洗牌</span>，讓程式隨機打亂牌卡。</span>
                                    </div>
                                    <div className="flex items-start">
                                        <span className="text-yellow-500 font-bold mr-2 shrink-0">2.</span>
                                        <span>憑直覺從牌堆中依序選出<span className="text-yellow-400 mx-1 font-serif">III</span>張牌。</span>
                                    </div>
                                    <div className="flex items-start">
                                        <span className="text-yellow-500 font-bold mr-2 shrink-0">3.</span>
                                        <span>系統將自動為您翻牌並顯示針對您選牌位置的詳細解讀。</span>
                                    </div>
                                </div>
                            </section>
                            
                            <p className="text-xs text-slate-500 mt-4 italic border-t border-slate-700 pt-2">
                                * 塔羅牌是一種自我探索的工具，結果僅供參考，真正的力量在於你自己的選擇與行動。
                            </p>
                        </div>

                        <button 
                            onClick={onClose}
                            className="w-full mt-6 py-2 bg-indigo-700 hover:bg-indigo-600 text-white rounded-lg transition-colors font-medium"
                        >
                            我了解了
                        </button>
                    </div>
                </div>
            );
        };

        // --- 卡片組件 (包含圖片錯誤處理) ---
        const TarotCard = ({ card, isRevealed, onClick, position, index }) => {
            const [imageError, setImageError] = useState(false);

            return (
                <div 
                    className={`relative w-32 h-56 md:w-56 md:h-96 cursor-pointer perspective-1000 transition-all duration-500 ease-in-out ${isRevealed ? '' : 'hover:-translate-y-2'}`}
                    onClick={onClick}
                    style={{
                        transitionDelay: `${index * 50}ms`
                    }}
                >
                    <div className={`w-full h-full relative preserve-3d transition-transform duration-700 shadow-2xl ${isRevealed ? 'rotate-y-180' : ''}`}>
                        {/* 卡背 (Card Back) */}
                        <div className="absolute w-full h-full backface-hidden rounded-xl border-2 border-yellow-600/50 bg-gradient-to-br from-indigo-900 via-purple-900 to-slate-900 flex items-center justify-center overflow-hidden">
                            {/* 神秘圖騰裝飾 */}
                            <div className="absolute inset-2 border border-yellow-500/30 rounded-lg opacity-50"></div>
                            <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-30"></div>
                            <div className="w-16 h-16 rounded-full border-2 border-yellow-500/40 flex items-center justify-center animate-pulse-slow">
                                <Sparkles className="text-yellow-500 w-8 h-8 opacity-60" />
                            </div>
                        </div>

                        {/* 卡面 (Card Front) */}
                        <div className="absolute w-full h-full backface-hidden rotate-y-180 rounded-xl bg-black border-4 border-yellow-600 overflow-hidden flex flex-col">
                            <div className="h-full relative bg-slate-800">
                                {!imageError ? (
                                    <>
                                        <img 
                                            src={card.image} 
                                            alt={card.name} 
                                            className="w-full h-full object-cover"
                                            onError={() => setImageError(true)}
                                        />
                                        {/* 底部文字遮罩 */}
                                        <div className="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black via-black/80 to-transparent p-3 pt-8 flex flex-col items-center justify-end text-center">
                                            <h3 className="font-serif font-bold text-yellow-100 text-sm md:text-base leading-tight drop-shadow-md">{card.name}</h3>
                                            <p className="text-[10px] text-yellow-400 uppercase tracking-widest mt-1">{card.keyword}</p>
                                        </div>
                                    </>
                                ) : (
                                    // 備用版面
                                    <div className="w-full h-full flex flex-col items-center justify-center p-4 text-center bg-gradient-to-b from-indigo-900 to-slate-900">
                                        <div className="mb-2 p-3 rounded-full border border-yellow-500/30 bg-indigo-950">
                                            <Sparkles className="text-yellow-400 w-6 h-6" />
                                        </div>
                                        <h3 className="font-serif font-bold text-yellow-100 text-sm">{card.name}</h3>
                                        <p className="text-[10px] text-yellow-500/60 mt-1">{card.keyword}</p>
                                        <span className="text-[9px] text-slate-500 mt-4 border border-slate-700 px-1 rounded">No Image</span>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                    
                    {/* 牌位標籤 */}
                    {isRevealed && position && (
                        <div className="absolute -top-8 left-0 right-0 text-center animate-fade-in">
                            <span className="text-yellow-400 text-sm font-bold tracking-widest bg-black/50 px-3 py-1 rounded-full uppercase shadow-lg backdrop-blur-sm border border-yellow-500/30">
                                {position}
                            </span>
                        </div>
                    )}
                </div>
            );
        };

        // --- 主應用程式 ---
        const MysticTarotApp = () => {
            const [gameState, setGameState] = useState('intro'); // intro, shuffling, spreading, revealing, finished
            const [deck, setDeck] = useState([]);
            const [selectedCards, setSelectedCards] = useState([]);
            const [isShuffling, setIsShuffling] = useState(false);
            const [showRules, setShowRules] = useState(false);

            // 初始化牌堆
            useEffect(() => {
                setDeck([...TAROT_DATA]);
            }, []);

            // 洗牌算法 (Fisher-Yates)
            const shuffleDeck = () => {
                setIsShuffling(true);
                setGameState('shuffling');
                
                // 模擬洗牌動畫時間 (2.5秒，配合 CSS 動畫)
                setTimeout(() => {
                    const newDeck = [...TAROT_DATA];
                    for (let i = newDeck.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [newDeck[i], newDeck[j]] = [newDeck[j], newDeck[i]];
                    }
                    setDeck(newDeck);
                    setIsShuffling(false);
                    setGameState('spreading');
                }, 2500);
            };

            // 選擇卡片
            const handleCardSelect = (index) => {
                if (gameState !== 'spreading' || selectedCards.length >= 3) return;
                
                // 檢查是否已經選過
                if (selectedCards.some(selection => selection.deckIndex === index)) return;

                const newSelection = {
                    deckIndex: index,
                    cardData: deck[index],
                    position: selectedCards.length === 0 ? "過去" : selectedCards.length === 1 ? "現在" : "未來"
                };

                const newSelectedCards = [...selectedCards, newSelection];
                setSelectedCards(newSelectedCards);

                if (newSelectedCards.length === 3) {
                    setTimeout(() => {
                        setGameState('revealing');
                    }, 500);
                }
            };

            // 重置
            const resetGame = () => {
                setGameState('intro');
                setSelectedCards([]);
            };

            return (
                <div className="min-h-screen bg-slate-950 text-slate-100 font-sans overflow-x-hidden relative selection:bg-purple-500 selection:text-white">
                    {/* 魔法背景效果 */}
                    <div className="fixed inset-0 z-0 pointer-events-none">
                        <div className="absolute top-0 left-0 w-full h-full bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-indigo-900/40 via-slate-950 to-slate-950"></div>
                        {/* 星星點綴 */}
                        {[...Array(20)].map((_, i) => (
                            <div 
                                key={i}
                                className="absolute rounded-full bg-white opacity-20 animate-pulse"
                                style={{
                                    top: `${Math.random() * 100}%`,
                                    left: `${Math.random() * 100}%`,
                                    width: `${Math.random() * 3 + 1}px`,
                                    height: `${Math.random() * 3 + 1}px`,
                                    animationDuration: `${Math.random() * 3 + 2}s`
                                }}
                            ></div>
                        ))}
                    </div>

                    <div className="relative z-10 container mx-auto px-4 py-8 min-h-screen flex flex-col items-center">
                        
                        {/* 頂部導航 */}
                        <div className="absolute top-4 right-4 z-20">
                            <button 
                                onClick={() => setShowRules(true)}
                                className="flex items-center gap-2 px-4 py-2 bg-indigo-900/50 hover:bg-indigo-800/80 rounded-full border border-indigo-500/30 transition-all text-sm text-indigo-200"
                            >
                                <HelpCircle size={18} />
                                <span className="hidden md:inline">占卜規則</span>
                            </button>
                        </div>

                        {/* 標題區 */}
                        <header className="text-center mb-4 animate-fade-in-down mt-8">
                            <div className="inline-flex items-center justify-center p-3 rounded-full bg-indigo-900/30 border border-indigo-500/30 mb-4 backdrop-blur-md">
                                <Sparkles className="text-yellow-400 mr-2" size={20} />
                                <span className="text-indigo-200 text-sm tracking-widest uppercase font-semibold">聖三角占卜</span>
                            </div>
                            <h1 className="text-4xl md:text-6xl font-serif font-bold bg-clip-text text-transparent bg-gradient-to-r from-yellow-200 via-yellow-400 to-yellow-600 drop-shadow-lg mb-2">
                                神秘塔羅
                            </h1>
                            <p className="text-slate-400 max-w-md mx-auto">
                                專注於你的問題，讓宇宙的智慧透過牌卡指引你的過去、現在與未來。
                            </p>
                        </header>

                        {/* 遊戲區域 */}
                        <main className={`w-full max-w-6xl flex-grow flex flex-col items-center ${gameState === 'spreading' || gameState === 'revealing' || gameState === 'finished' ? 'justify-start pt-8' : 'justify-center'}`}>
                            
                            {/* 階段 1: 介紹 */}
                            {gameState === 'intro' && (
                                <div className="text-center animate-fade-in space-y-8">
                                    <div 
                                        onClick={shuffleDeck}
                                        className="w-48 h-72 mx-auto bg-gradient-to-br from-indigo-900 to-slate-900 rounded-xl border-2 border-yellow-600/30 shadow-2xl flex items-center justify-center transform hover:scale-105 transition-transform duration-500 cursor-pointer group"
                                    >
                                        <div className="text-6xl opacity-20 group-hover:opacity-40 transition-opacity">?</div>
                                        <div className="absolute bottom-4 text-xs text-yellow-500/50 uppercase tracking-widest font-semibold opacity-0 group-hover:opacity-100 transition-opacity">
                                            點擊抽牌
                                        </div>
                                    </div>
                                    
                                    <div className="flex flex-col items-center gap-4">
                                        <button 
                                            onClick={shuffleDeck}
                                            className="group relative px-8 py-4 bg-transparent overflow-hidden rounded-full transition-all duration-300 hover:shadow-[0_0_20px_rgba(168,85,247,0.5)] border border-purple-500/50"
                                        >
                                            <div className="absolute inset-0 w-0 bg-gradient-to-r from-purple-600 to-indigo-600 transition-all duration-[250ms] ease-out group-hover:w-full opacity-20"></div>
                                            <span className="relative text-xl font-serif tracking-widest text-purple-200 group-hover:text-white flex items-center">
                                                <RefreshCw className="mr-2 w-5 h-5" /> 開始抽牌
                                            </span>
                                        </button>
                                        <button 
                                            onClick={() => setShowRules(true)}
                                            className="text-slate-400 hover:text-yellow-400 text-sm underline underline-offset-4 transition-colors"
                                        >
                                            第一次使用？查看規則
                                        </button>
                                    </div>
                                </div>
                            )}

                            {/* 階段 2: 洗牌中 (進階洗牌動畫) */}
                            {gameState === 'shuffling' && (
                                <div className="flex flex-col items-center justify-center min-h-[400px]">
                                    <div className="relative w-32 h-48 md:w-40 md:h-60">
                                        {/* 基底牌堆 */}
                                        <div className="absolute inset-0 bg-indigo-900 rounded-xl border-2 border-yellow-600 shadow-2xl"></div>

                                        {/* 左側飛出的牌組動畫 */}
                                        {[...Array(3)].map((_, i) => (
                                            <div key={`l-${i}`}
                                                className="absolute inset-0 bg-indigo-900 rounded-xl border border-yellow-500/40 shadow-lg"
                                                style={{
                                                    animation: 'shuffleLeft 1s infinite ease-in-out',
                                                    animationDelay: `${i * 0.1}s`,
                                                    zIndex: 10 + i
                                                }}>
                                                <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-30"></div>
                                            </div>
                                        ))}

                                        {/* 右側飛出的牌組動畫 */}
                                        {[...Array(3)].map((_, i) => (
                                            <div key={`r-${i}`}
                                                className="absolute inset-0 bg-indigo-900 rounded-xl border border-yellow-500/40 shadow-lg"
                                                style={{
                                                    animation: 'shuffleRight 1s infinite ease-in-out',
                                                    animationDelay: `${i * 0.1 + 0.05}s`,
                                                    zIndex: 10 + i
                                                }}>
                                                <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-30"></div>
                                            </div>
                                        ))}
                                        
                                        {/* 中心旋轉裝飾 */}
                                        <div className="absolute inset-0 flex items-center justify-center z-30 pointer-events-none">
                                            <Sparkles className="text-yellow-400 animate-spin-slow w-12 h-12 opacity-80" />
                                        </div>
                                    </div>
                                    <p className="mt-12 text-indigo-200 tracking-[0.2em] animate-pulse font-medium">
                                        洗牌中... 請默念問題，準備抽牌
                                    </p>
                                </div>
                            )}

                            {/* 階段 3: 抽牌 (攤牌模式) */}
                            {gameState === 'spreading' && (
                                <div className="w-full animate-fade-in text-center">
                                    <h2 className="text-2xl font-serif text-white mb-6">
                                        請憑直覺選出 <span className="text-yellow-400 font-bold mx-1 font-serif">III</span> 張牌
                                    </h2>
                                    
                                    {/* 顯示選中的進度 */}
                                    <div className="flex justify-center gap-4 mb-8">
                                        {[0, 1, 2].map((i) => (
                                            <div key={i} className={`w-3 h-3 rounded-full transition-colors duration-300 ${selectedCards.length > i ? 'bg-yellow-400 shadow-[0_0_10px_rgba(250,204,21,0.8)]' : 'bg-slate-700'}`}></div>
                                        ))}
                                    </div>

                                    {/* 牌堆扇形排列 (簡化為網格以便操作) */}
                                    <div className="grid grid-cols-6 sm:grid-cols-8 md:grid-cols-11 gap-2 md:gap-4 max-w-4xl mx-auto px-2">
                                        {deck.map((card, index) => {
                                            const isSelected = selectedCards.some(s => s.deckIndex === index);
                                            return (
                                                <div 
                                                    key={card.id}
                                                    onClick={() => handleCardSelect(index)}
                                                    className={`
                                                        aspect-[2/3] rounded-md border border-indigo-500/30 bg-indigo-950/80 cursor-pointer 
                                                        transition-all duration-300 hover:scale-110 hover:shadow-[0_0_15px_rgba(168,85,247,0.6)]
                                                        ${isSelected ? 'opacity-0 pointer-events-none translate-y-10' : 'opacity-100'}
                                                    `}
                                                >
                                                    <div className="w-full h-full bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-50"></div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            )}

                            {/* 階段 4: 揭牌與結果 */}
                            {(gameState === 'revealing' || gameState === 'finished') && (
                                <div className="w-full flex flex-col items-center animate-fade-in pb-10">
                                    {/* 牌桌 */}
                                    <div className="flex flex-col md:flex-row gap-8 md:gap-12 items-center justify-center mb-12 mt-4 px-2">
                                        {selectedCards.map((selection, index) => (
                                            <div key={index} className="flex flex-col items-center gap-4">
                                                <TarotCard 
                                                    card={selection.cardData} 
                                                    isRevealed={true} 
                                                    position={selection.position}
                                                    index={index}
                                                    total={3}
                                                />
                                            </div>
                                        ))}
                                    </div>

                                    {/* 解讀區 */}
                                    <div className="grid md:grid-cols-3 gap-6 max-w-6xl w-full px-4">
                                        {selectedCards.map((selection, index) => (
                                            <div 
                                                key={index} 
                                                className="bg-slate-900/60 backdrop-blur-md p-6 rounded-xl border border-indigo-500/20 shadow-xl hover:border-indigo-500/50 transition-colors animate-slide-up"
                                                style={{ animationDelay: `${index * 200 + 500}ms`, animationFillMode: 'both' }}
                                            >
                                                <div className="flex items-center gap-2 mb-3 border-b border-indigo-500/30 pb-2">
                                                    <span className="text-yellow-500 text-xs font-bold uppercase tracking-widest border border-yellow-500/50 px-2 py-0.5 rounded">
                                                        {selection.position}
                                                    </span>
                                                    <h3 className="text-lg font-bold text-white">{selection.cardData.name}</h3>
                                                </div>
                                                <p className="text-indigo-200 mb-2 font-medium flex items-center">
                                                    <Info className="w-4 h-4 mr-1 inline" />
                                                    關鍵字：{selection.cardData.keyword}
                                                </p>
                                                {/* 解讀內容 */}
                                                <p className="text-slate-300 text-sm leading-relaxed whitespace-pre-line">
                                                    {generateInterpretation(selection.cardData, selection.position)}
                                                </p>
                                            </div>
                                        ))}
                                    </div>

                                    <div className="mt-12 animate-fade-in" style={{ animationDelay: '1200ms', animationFillMode: 'both' }}>
                                        <button 
                                            onClick={resetGame}
                                            className="px-8 py-3 bg-gradient-to-r from-yellow-600 to-yellow-500 text-slate-900 font-bold rounded-full shadow-lg hover:shadow-yellow-500/20 hover:scale-105 transition-all flex items-center"
                                        >
                                            <RotateCcw className="mr-2 w-4 h-4" /> 再次占卜
                                        </button>
                                    </div>
                                </div>
                            )}

                        </main>
                        
                        <footer className="mt-8 text-slate-600 text-xs text-center">
                            <p>© 2024 神秘塔羅 (Mystic Tarot). 僅供娛樂與心靈參考。</p>
                        </footer>
                    </div>

                    {/* 規則 Modal */}
                    <RulesModal isOpen={showRules} onClose={() => setShowRules(false)} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MysticTarotApp />);
    </script>
</body>
</html>
